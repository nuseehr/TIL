
# TCP / UDP

트랜스포트 계층은 송신자와 수신자를 연결하는 통신서비스를 제공하는 계층이다. 즉, **데이터의 전달을 담당하는 계층**이라고 할 수 있다. 그리고 데이터를 보내기 위해 사용하는 프로토콜이 있는데 그 프로토콜들이 바로 오늘의 TCP와 UDP이다.

<br/>
<br/>

## TCP(Transmission Control Protocol)

TCP는 전송제어 프로토콜로서, 근거리 통신망이나 인터넷에 연결된 컴퓨터에서 실행되는 프로그램 간에 일련의 옥텟(octet)을 안정적으로, 순서대로, 에러 없이 전송하고, 수신된 패킷을 원래의 메시지로 조립하는 일을 담당한다.

<br/>

### **연결 설정 (3-way handshake)**

TCP는 전화를 거는 것처럼 상대와 연결을 설정하고 통신을 시작한다. 이 과정을 3 방향 핸드셰이크 메커니즘(3-way Handshake)라고 하고 절차는 아래와 같다.

1. 상대에게 통신을 하고 싶다는 메시지를 보낸다.**(SYN)**
2. 상대는 그 메시지에 대한 응답 + 나도 통신 준비가 되었다는 메시지를 보낸다.(SYN-ACK)
3. 2번에서 받은 메시지에 응답을 보낸다.(ACK)

이와 같은 과정을 통해 나와 상대가 통신준비를 마쳤고, 현재 통신이 연결되어 있음을 보장하게 된다. 기존의 회선교환 방식의 개념과 유사하지만 단순히 서로 연결되어 있다는 것만 보장한다.

<br/>

### 연결 해제 (4-way handshake)

1) 클라이언트에서 서버와의 연결 종료를 위해 서버에 **FIN** 패킷을 보내고 **FIN_WAIT1** 상태가 된다. **(FIN)**

2) 서버는 클라이언트로부터 **FIN** 을 받고 응답 패킷 **ACK** 을 보냅니다. 상태는 **CLOSE_WAIT**가 된다 **(ACK)**

3) 서버가 통신이 끝나면, 즉 연결을 종료할 준비가 되면 클라이언트에게 **FIN** 패킷을 보내고 **LAST_WAIT** 상태가 된다 **(FIN)**

4) 클라이언트는 확인 패킷 **ACK** 을 보내고 **TIME_WAIT** 상태가 된다. **(ACK)**

<br/>

### **신뢰성 보장과 흐름 제어**(Flow Control)

연결설정을 통해 통신준비를 마치면 이제 서로 데이터를 주고받을 수 있다. 다만 네트워크를 통해서 한 번에 보낼 수 있는 데이터의 양은 제한이 되어 있으므로 분할해서 보내야 된다. 간단히 비유하면 책 한 권 내용을 보내줘야 되는데 이것을 통째로 전송할 수 없으므로 한 장씩 보내는 것으로 생각하면 쉽다. 따라서 분할된 데이터에는 고유번호가 부여되는데 이는 책의 쪽 번호와 같다고 생각하면 된다. 이를 바탕으로 보내는 사람은 현재 몇 쪽을 보낸 것인지 상대에게 알려줄 수 있고, 받는 사람은 다음에 받을 자료가 몇 쪽인지를 알고 보내는 사람에게 요청할 수 있게 된다. 이를 통해 데이터가 제대로 전달됐는지도 알 수 있다. 

<br/>

### **연결지향적**(Connection-oriented)

같은 전송계층의 UDP가 비연결성(connectionless)인 것과는 달리, TCP는 연결지향적이다. 이 경우, 느슨한 연결(loosly connected)을 갖으므로 강한 연결을 의미하는 가상회선이라는 표현 보다는 오히려 연결지향적이라고 표현한다. 연결 관리를 위한 연결설정 및 연결해제가 필요하다. 양단간 애플리케이션 및 프로세스는 TCP가 제공하는 연결성 회선을 통하여 서로 통신한다.

<br/>
<br/>

## UDP(User Datagram Protocol)

인터넷을 통해 데이터를 보낼 수 있는 표준 통신 프로토콜이다. TCP가 전화와 비슷하다면, UDP는 일방적으로 보내는 소포와 비슷하다. 수신 측에 제대로 도착했는지 확인 여부가 보장되지 않아 비신뢰성 서비스이고, 빠른 요청과 응답이 필요한 실시간 응용에 적합하고, 전송속도에 제한이 없다. TCP처럼 16비트의 포트 번호를 사용하지만, 헤더는 고정크기의 8바이트만 사용하여 단순하다. 즉, 헤더 처리에 많은 시간과 노력을 요구하지 않는다.

<br/>

### 비연결성

UDP에 의해 보내진 각 사용자의 데이터 그램은 서로 독립적이다. 동일한 발신지 프로그램으로부터 동일한 목적지 프로그램으로 전송되어도 서로 다른 데이터 그램 사이에는 연관 관계가 없다. 사용자 데이터 그램에는 번호가 붙지 않고, 연결 설정과 연결 종료 과정이 없다. TCP처럼 핸드셰이킹(Handshaking) 과정이 없음으로 논리적인 가상 회선 연결이 필요 없다.

<br/>

### 흐름제어 & 오류제어

UDP는 흐름 제어도 없고, 윈도 메커니즘도 없기 때문에, 수신 측에서 들어오는 메시지로 인해 오버플로우가 발생할 수 있다. 또한, UDP에는 검사 합을 제외하고 오류 제어 메커니즘이 없다. 즉, 메시지가 중복되거나 없어지면 송신자 측에서는 알 수 없다는 의미다. 수신자가 체크섬(Checksum)을 사용하여 오류가 있음을 발견할 경우, 사용자 데이터 그램은 폐기된다.

<br/>
<br/>

## TCP / UDP 비교

TCP는 연결지향형 프로토콜이고, UDP는 비 연결지향형 프로토콜이다. 패킷 교환방식에서 TCP는 가상회선 방식을 이용하지만, UDP는 데이터 그램 방식을 이용한다. 전송 순서를 보장해주는 TCP와 달리, UDP는 전송 순서가 바뀔 수 있다. 또한, TCP는 일대일 통신을 하고, 수신 여부를 확인하지만, UDP는 일대일, 다대일 다대다 통신을 하며, 수신 여부를 확인하지 않는다. 신뢰성은 TCP가 UDP보다 더 높지만, 속도는 UDP가 TCP보다 빠르다. TCP는 사용자의 요청이 있으면, 데이터 확인 및 전송, 재전송이 가능하다. 하지만 UDP는 수신 확인을 하지 않고, 손실된 데이터를 다시 전송하지 않는다. TCP와 UDP 모두 오류를 검사할 수 있지만, TCP만 흐름 제어와 정체를 모두 가지고 있어 오류를 수정할 수 있다. 따라서 신뢰성이 요구되는 애플리케이션에서는 TCP를 사용하고, 간단한 데이터를 빠른 속도로 전송하고자 하는 애플리케이션에는 UDP를 사용한다.

| 프로토콜 종류 | TCP | UDP |
| --- | --- | --- |
|  연결방식 | 연결형 서비스 | 비연결형 서비스 |
| 패킷 교환 방식 | 가상 회선 방식 | 데이터그램 방식 |
| 전송 순서 | 전송 순서를 보장 | 전송순서가 바뀔 수 있음 |
| 수신 여부 확인 | 수신 여부를 확인함 | 수신 여부를 확인하지 않음 |
| 통신방식 | 1:1 통신 | 1:1 OR 1:N OR N:N 통신 |
| 신뢰성 | 높다 | 낮다 |
| 속도 | 느리다 | 빠르다 |